<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="/assets-v1/templates_copy/assets/styles/output.css"
    />
    <link
      rel="stylesheet"
      href="/assets-v1/templates_copy/assets/styles/base.css"
    />
    <title>Authentication Page</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
  </head>
  <body>
    <div id="app">
      <div class="grid grid-cols-9">
        <div class="col-span-2 border-r border-[#E6E6E6] h-dvh">
          <div class="bg-white px-7 py-9">
            <img
              src="../assets-v1/images/L8Logo.png"
              alt="Layer8"
              width="250"
              height="535"
              class="mb-12"
            />
            <div>
              <div
                class="flex space-x-2.5 items-center pl-7 py-2.5 cursor-pointer mb-5 rounded-md bg-[#4F80E1]"
              >
                <svg
                  width="21"
                  height="22"
                  viewBox="0 0 21 22"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="group-hover:fill-white"
                >
                  <path
                    d="M11.3056 8.43597V3.21802H18.2629V8.43597H11.3056ZM2.60901 11.9146V3.21802H9.56628V11.9146H2.60901ZM11.3056 18.8719V10.1753H18.2629V18.8719H11.3056ZM2.60901 18.8719V13.6539H9.56628V18.8719H2.60901ZM4.34833 10.1753H7.82696V4.95734H4.34833V10.1753ZM13.0449 17.1326H16.5236V11.9146H13.0449V17.1326ZM13.0449 6.69665H16.5236V4.95734H13.0449V6.69665ZM4.34833 17.1326H7.82696V15.3932H4.34833V17.1326Z"
                    fill="white"
                  />
                </svg>
                <span class="font-medium text-white text-base">Dashboard</span>
              </div>
              <div
                @click="logoutUser"
                class="flex space-x-2.5 items-center pl-7 py-3 cursor-pointer mb-5"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M6.91625 14.7756C6.91625 15.0258 6.81688 15.2656 6.64001 15.4425C6.46314 15.6194 6.22326 15.7188 5.97312 15.7188H1.57187C1.15499 15.7188 0.755175 15.5531 0.460391 15.2584C0.165608 14.9636 0 14.5638 0 14.1469V1.57188C0 1.15499 0.165608 0.755175 0.460391 0.460392C0.755175 0.165608 1.15499 0 1.57187 0H5.97312C6.22326 0 6.46314 0.0993647 6.64001 0.276235C6.81688 0.453105 6.91625 0.692993 6.91625 0.943125C6.91625 1.19326 6.81688 1.43315 6.64001 1.61002C6.46314 1.78689 6.22326 1.88625 5.97312 1.88625H1.88625V13.8325H5.97312C6.22326 13.8325 6.46314 13.9319 6.64001 14.1087C6.81688 14.2856 6.91625 14.5255 6.91625 14.7756ZM15.4429 7.19211L12.2991 4.04836C12.122 3.87119 11.8817 3.77165 11.6311 3.77165C11.3805 3.77165 11.1402 3.87119 10.963 4.04836C10.7859 4.22554 10.6863 4.46585 10.6863 4.71641C10.6863 4.96698 10.7859 5.20728 10.963 5.38446L12.4964 6.91625H5.97312C5.72299 6.91625 5.4831 7.01561 5.30623 7.19249C5.12936 7.36936 5.03 7.60924 5.03 7.85938C5.03 8.10951 5.12936 8.34939 5.30623 8.52627C5.4831 8.70314 5.72299 8.8025 5.97312 8.8025H12.4964L10.9623 10.3359C10.7851 10.513 10.6855 10.7533 10.6855 11.0039C10.6855 11.2545 10.7851 11.4948 10.9623 11.672C11.1394 11.8491 11.3797 11.9487 11.6303 11.9487C11.8809 11.9487 12.1212 11.8491 12.2983 11.672L15.4421 8.52821C15.5301 8.44064 15.5999 8.33657 15.6476 8.22196C15.6952 8.10735 15.7198 7.98445 15.7199 7.86032C15.72 7.7362 15.6955 7.61327 15.648 7.49861C15.6005 7.38394 15.5308 7.27979 15.4429 7.19211Z"
                    fill="black"
                  />
                </svg>
                <span class="font-medium text-black text-base">Log out</span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-span-7">
          <div class="bg-white py-5 mx-10 flex justify-end">
            <div class="flex space-x-5 items-center">
              <div>
                <div class="font-bold text-xs text-black text-end block">
                  {{ user.first_name }} {{ user.last_name }}
                </div>
                <div class="font-bold text-[9px] text-[#8F8F8F] text-end">
                  {{ user.username }}
                </div>
              </div>
              <img
                src="/assets-v1/templates_copy/assets/images/user_image.png"
              />
            </div>
          </div>
          <div class="bg-[#F6F8FF] h-dvh p-10">
            <div class="flex justify-between items-center mb-5">
              <div>
                <div class="font-bold text-3xl text-black mb-4 text-start">
                  Settings
                </div>
                <div class="font-normal text-xs text-black mb-4 text-start">
                  Manage your account settings
                </div>
              </div>
              <div class="flex space-x-5">
                <button
                  @click="changeDisplayName"
                  class="w-[128px] bg-white border-2 border-[#4F80E1] rounded-lg py-3 font-medium text-[#4F80E1] hover:text-white hover:bg-[#4F80E1] hover:border-none"
                >
                  Save change
                </button>
                <button
                  class="w-[128px] bg-white border-2 border-[#4F80E1] rounded-lg py-3 font-medium text-[#4F80E1] hover:text-white hover:bg-[#4F80E1] hover:border-none"
                >
                  Cancel
                </button>
              </div>
            </div>
            <div class="bg-white rounded-xl border-none p-12">
              <div class="pb-3 mb-5 border-b border-[#D9D9D9]">
                <div class="font-bold text-3xl text-black mb-3 text-start">
                  General Information
                </div>
                <div class="font-normal text-xs text-black text-start">
                  Lorem ipsum dolor sit amet consectetur.
                </div>
              </div>
              <div class="flex space-x-5 items-center mb-8">
                <img
                  class="w-16 h-16"
                  src="/assets-v1/templates_copy/assets/images/user_image.svg"
                />
                <div>
                  <div class="font-bold text-sm text-black text-start block">
                    {{ user.first_name }} {{ user.last_name }}
                  </div>
                  <div class="font-bold text-[10px] text-[#8F8F8F] text-start">
                    {{ user.username }}
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-3 gap-x-12 gap-y-6 mb-6">
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">Username</label>
                  <input class="border border-[#BDC3CA] rounded-lg bg-[#ECF4FD] px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" readonly :value="user.username" />
                </div>
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">First Name</label>
                  <input class="border border-[#BDC3CA] rounded-lg bg-[#ECF4FD] px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" readonly :value="user.first_name" />
                </div>
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">Last Name</label>
                  <input class="border border-[#BDC3CA] rounded-lg bg-[#ECF4FD] px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" readonly :value="user.last_name" />
                </div>
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">Country</label>
                  <input class="border border-[#BDC3CA] rounded-lg bg-[#ECF4FD] px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" readonly :value="user.country" />
                </div>
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">Email</label>
                  <input class="border border-[#BDC3CA] rounded-lg bg-[#ECF4FD] px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" readonly :value="user.email" />
                </div>
                <div>
                  <label class="font-normal text-black text-sm text-start mb-2 block">Display Name</label>
                  <input class="border border-[#BDC3CA] rounded-lg px-5 py-4 text-start text-base text-[#8F8F8F] focus:outline-none w-full" type="text" v-model="newDisplayName" />
                </div>
                <div class="col-span-2">Email is <span v-if="!user.email_verified">not</span> verified.</div>
                <button
                  v-if="!user.email_verified"
                  @click="verifyEmail"
                  class="w-full bg-white border-2 border-[#4F80E1] rounded-lg py-3 font-medium text-[#4F80E1] hover:text-white hover:bg-[#4F80E1] hover:border-none"
                >
                  Verify Email
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { ref, onMounted, createApp } = Vue;

      const token = ref(localStorage.getItem("token") || null);
      const user = ref({
        email: "",
        username: "",
        first_name: "",
        last_name: "",
        display_name: "",
        country: "",
        email_verified: false,
      });
      const newDisplayName = ref("")

      const getUserDetails = async () => {
        try {
          //const resp = await window.fetch("https://layer8devproxy.net/api/v1/profile",
          const resp = await window.fetch(
            "http://localhost:5001/api/v1/profile",
            {
              method: "GET",
              headers: {
                "Content-Type": "Application/Json",
                Authorization: `Bearer ${token.value}`,
              },
            }
          );
          const data = await resp.json();
          user.value = data;
          newDisplayName.value = data.display_name
        } catch (error) {
          console.error(error);
        }
      };

      const logoutUser = () => {
        token.value = null;
        localStorage.removeItem("token");
        /* router.push("/"); */
        //window.location.href = "https://layer8devproxy.net/";
        window.location.href = "http://localhost:5001/";
      };

      const verifyEmail = async () => {
        try {
          //const resp = await window.fetch("https://layer8devproxy.net/api/v1/verify-email",
          const resp = await window.fetch(
            "http://localhost:5001/api/v1/verify-email",
            {
              method: "POST",
              headers: {
                "Content-Type": "Application/Json",
                Authorization: `Bearer ${token.value}`,
              },
            }
          );
          const data = await resp.json();
          if (data.message === "OK!") {
            alert("Email verified!");
            user.value.email_verified = true;
          } else {
            alert("Email verification failed!");
          }
        } catch (error) {
          console.error(error);
        }
      };

      const changeDisplayName = async () => {
        try {
          //const resp = await window.fetch("https://layer8devproxy.net/api/v1/change-display-name",
          const resp = await window.fetch(
            "http://localhost:5001/api/v1/change-display-name",
            {
              method: "POST",
              headers: {
                "Content-Type": "Application/Json",
                Authorization: `Bearer ${token.value}`,
              },
              body: JSON.stringify({
                display_name: newDisplayName.value,
              }),
            }
          );
          const data = await resp.json();
          if (data.message === "OK!") {
            alert("Display name changed!");
            user.value.display_name = newDisplayName.value;
          } else {
            alert("Display name change failed!");
          }
        } catch (error) {
          console.error(error);
        }
      };

      const app = createApp({
        setup() {
          onMounted(() => {
            getUserDetails();
          });

          return {
            user,
            changeDisplayName,
            verifyEmail,
            logoutUser,
            newDisplayName
          };
        },
      });

      app.mount("#app");
    </script>
  </body>
</html>
